{% extends 'base.html' %}
{% load core_tags %}

{% block content %}

<div class="row">
  <div class="col s12">

    <div class="card">
      <div class="card-content">
        <div class="card-title row">
          <div class="col s12 m8">{{exam}}</div>

          {% if score.has_completed == False %}
          <div id="timer" class="col s12 m4 right"></div>
          {% endif %}
        </div>

        {% if score.has_completed == False %}
          <div class="section cbt">

            <div class="examContainer">

              <form id="exam" method="POST">
                {% csrf_token %}

                {% for question in questions %}

                <div class="eachExam">
                  <ul class="collection with-header">
                    <li class="collection-header">
                      <h6>{{question.question|linebreaks}}</h6>
                    </li>

                    <input type="hidden" id="{{question.id}}_Null" name="{{question.id}}" value="-Null-">
                    {% for option in question.get_fields %}
                    <li class="collection-item">
                      <label for="{{question.id}}_{{option}}">
                        <input type="radio" id="{{question.id}}_{{option}}" name="{{question.id}}"
                          value="{{option}}" class="with-gap">
                        <span>{{ option}}</span>
                      </label>
                    </li>
                    {% endfor %}
                  </ul>
                </div>

                {% endfor %}

                <a class="btn prev">&#10094; Previous</a>
                <a class="btn next">Next &#10095;</a>

                <div style="margin-top:2em">
                  <input type="submit" class="btn submit" value="submit">
                </div>


              </form>


            </div>

            <div class="center section">
              {% for question in questions %}
              <span class="dot" data-id="{{forloop.counter}}">{{forloop.counter}}</span>
              {% endfor %}
            </div>

          </div>
        {% else %}
          <div class="section">
            <p>You have submitted this exam.</p>
            <h5>Your score is {{score.score}}%</h5>

            <a href="{% url 'score-detail' exam.id user.id %}">Click here to view result analysis.</a>
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>

{% endblock content %}



{% block morejs %}
  {% if score.has_completed == False %}

    <script>

      /* timer */
      let countDownDate = new Date("{{time|date:'Y/m/d H:i:s'}}").getTime()

      var x = setInterval(function () {

        // Get today's date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Display the result in the element with id="demo"
        document.getElementById("timer").innerHTML = hours + "h "
          + minutes + "m " + seconds + "s ";

        // If the count down is finished, write some text
        if (distance < 0) {
          clearInterval(x);
          document.getElementById("timer").innerHTML = "TIME EXHAUSTED";
          $('#exam').submit()
        }
      }, 1000);


      /* slideshow */

      var slideIndex = 1;

      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides(slideIndex += n);
      }

      function currentSlide(n) {
        showSlides(slideIndex = n);
      }

      $('.examContainer .prev').on('click', function () {
        plusSlides(-1);
      })

      $('.examContainer .next').on('click', function () {
        plusSlides(1);
      })
      $('.dot').on('click', function () {
        currentSlide($(this).data('id'));
      })

      function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("eachExam");
        var dots = document.getElementsByClassName("dot");
        if (n > slides.length) { slideIndex = 1 }
        if (n < 1) { slideIndex = slides.length }
        for (i = 0; i < slides.length; i++) {
          slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
          dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex - 1].style.display = "block";
        dots[slideIndex - 1].className += " active";
      }

      $('form').on('submit', function(event){
          var status = confirm('Are you sure you want to submit now? This action cannot be undone')
          if (!status) {
              event.preventDefault()
          }
      })


    </script>

  {% endif %}

{% endblock morejs %}
